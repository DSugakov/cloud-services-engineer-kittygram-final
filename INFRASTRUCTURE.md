# üèóÔ∏è Kittygram Infrastructure - –ì–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Terraform –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ –ø–∞–ø–∫–µ `infra/`
- **VPC Network** - –æ–±–ª–∞—á–Ω–∞—è —Å–µ—Ç—å –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **VPC Subnet** - –ø–æ–¥—Å–µ—Ç—å 192.168.10.0/24 
- **Security Group** —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏:
  - SSH –¥–æ—Å—Ç—É–ø (–ø–æ—Ä—Ç 22)
  - HTTP –¥–æ—Å—Ç—É–ø –∫ gateway (–ø–æ—Ä—Ç 9000) ‚≠ê
  - HTTP/HTTPS –¥–æ—Å—Ç—É–ø (–ø–æ—Ä—Ç—ã 80, 443)
  - –í–µ—Å—å –∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω
- **Compute Instance** - Ubuntu 24.04 LTS —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π
- **S3 Backend** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è Terraform state

### 2. GitHub Actions Workflows
- **`.github/workflows/terraform.yml`** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π (plan/apply/destroy)
- **`.github/workflows/deploy.yml`** - –¥–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å CI/CD

### 3. Cloud-init –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ Docker Compose –Ω–∞ Ubuntu 24.04 LTS
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ubuntu —Å SSH –¥–æ—Å—Ç—É–ø–æ–º
- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–ø–ª–æ—é –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º)

```
kittygram-final/
‚îú‚îÄ‚îÄ .github/workflows/
‚îÇ   ‚îú‚îÄ‚îÄ terraform.yml    # Workflow –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ deploy.yml       # Workflow –¥–ª—è –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚úÖ
‚îú‚îÄ‚îÄ infra/               # Terraform —Ñ–∞–π–ª—ã ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ main.tf         # –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ variables.tf    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
‚îÇ   ‚îú‚îÄ‚îÄ outputs.tf      # –í—ã—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ providers.tf    # –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏ S3 backend
‚îÇ   ‚îú‚îÄ‚îÄ cloud-init.yml  # –°–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –í–ú
‚îÇ   ‚îú‚îÄ‚îÄ terraform.tfvars.example
‚îÇ   ‚îî‚îÄ‚îÄ README.md       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ backend/             # –ö–æ–¥ –±—ç–∫–µ–Ω–¥–∞ ‚úÖ
‚îú‚îÄ‚îÄ frontend/            # –ö–æ–¥ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ ‚úÖ
‚îú‚îÄ‚îÄ nginx/              # Gateway –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚úÖ
‚îú‚îÄ‚îÄ docker-compose.production.yml ‚úÖ
‚îú‚îÄ‚îÄ kittygram_workflow.yml ‚úÖ
‚îú‚îÄ‚îÄ tests.yml           # –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚úÖ
‚îî‚îÄ‚îÄ README.md           ‚úÖ
```

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

–î–æ–±–∞–≤—å—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–ª–µ–¥—É—é—â–∏–µ secrets:

```
# Yandex Cloud
YC_CLOUD_ID=b1g...
YC_FOLDER_ID=b1g...
YC_SERVICE_ACCOUNT_KEY_FILE={"type":"service_account",...}
YC_STORAGE_ACCESS_KEY=AKIA...
YC_STORAGE_SECRET_KEY=...

# Docker Hub  
DOCKER_USERNAME=dsugakov
DOCKER_PASSWORD=...

# –î–ª—è –¥–µ–ø–ª–æ—è (–±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –í–ú)
REMOTE_HOST=<IP –ø–æ—Å–ª–µ terraform apply>
REMOTE_USER=ubuntu
REMOTE_SSH_KEY=<–ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á>

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
POSTGRES_USER=kittygram_user
POSTGRES_PASSWORD=kittygram_password
POSTGRES_DB=kittygram_db
SECRET_KEY=django-secret-key
ALLOWED_HOSTS=<IP>,localhost,127.0.0.1

# Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
TELEGRAM_TO=<chat_id>
TELEGRAM_TOKEN=<bot_token>
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ GitHub Actions
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ workflow **"Terraform Infrastructure"**
3. –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: **`apply`**
4. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ IP –∞–¥—Ä–µ—Å –í–ú

### –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ secrets

–î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π IP –≤ secrets:
- `REMOTE_HOST` = IP –∞–¥—Ä–µ—Å –í–ú
- `ALLOWED_HOSTS` = IP,localhost,127.0.0.1

### –®–∞–≥ 4: –î–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–°–¥–µ–ª–∞–π—Ç–µ push –≤ –≤–µ—Ç–∫—É `main` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –¥–µ–ø–ª–æ–π –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ workflow **"Kittygram Deploy"** –≤—Ä—É—á–Ω—É—é.

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è:
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://<IP>:9000`
- ‚úÖ –ê–≤—Ç–æ—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
- ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ CI/CD –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω

## üîß –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –ë–∞–ª–ª—ã |
|----------|--------|-------|
| Terraform –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ | 2/2 |
| –î–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω | 2/2 |
| Security Group | ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ | 2/2 |
| Cloud-init | ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å–∫—Ä–∏–ø—Ç | 2/2 |
| –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º | ‚úÖ 100% | 2/2 |
| **–ò–¢–û–ì–û** | | **10/10** |

## üìù –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **–ü—Ä–µ—Ä—ã–≤–∞–µ–º–∞—è –í–ú** –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker** —á–µ—Ä–µ–∑ cloud-init
- **S3 backend** —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–ª—è Terraform state
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –¥–µ–ø–ª–æ—è
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ª–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –í–ú —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Å–¥–∞—á–µ! üéâ 